import{_ as f,o as c,c as d,f as n,t as a,n as g,r as m,e as u,b as P}from"./index.69e263e6.js";const v={props:["headers","userId"],data(){return{twitchName:"",leftPercent:0,rightPercent:0,leftPrediction:{title:"",channel_points:""},rightPrediction:{title:"",channel_points:""},showPrediction:!1}},computed:{predictionChannelPoints(){return[this.leftPrediction.channel_points,this.rightPrediction.channel_points]}},mounted(){this.fetchPredictionInterval()},watch:{predictionChannelPoints(e){this.calculatePercent(...e)}},methods:{calculatePercent(e,i){const s=e+i;this.leftPercent=Math.round(e/s*100),this.rightPercent=Math.round(i/s*100)},checkNameLength(e){return e.length>11?e.slice(0,11-3)+"...":e},fetchPredictionInterval(){setInterval(async()=>{const{data:e}=await fetch(`https://api.twitch.tv/helix/predictions?broadcaster_id=${this.userId}`,{headers:this.headers}).then(s=>s.json());if(e==null){console.log("ERROR: no predictions to fetch");return}const i=e.shift();i.status==="ACTIVE"&&(this.showPrediction=!0),i.locked_at!==null&&setTimeout(()=>{this.showPrediction=!1},6e4),this.showPrediction=!0,this.leftPrediction=i.outcomes[0],this.rightPrediction=i.outcomes[1]},2e3)}}},w={class:"predictionTitleContainer"},C={class:"predictionContainer"},R={class:"leftPrediction"},I={id:"predictionNumber"},N={class:"rightPrediction"},S={id:"predictionNumber"};function k(e,i,s,_,t,o){return c(),d("div",{class:g({fadeIn:t.showPrediction,fadeOut:!t.showPrediction})},[n("div",w,[n("h3",null,a(o.checkNameLength(t.leftPrediction.title)),1),n("h3",null,a(o.checkNameLength(t.rightPrediction.title)),1)]),n("div",C,[n("div",R,[n("div",I,[n("div",null,a(t.leftPercent)+"%",1)])]),n("div",N,[n("div",S,[n("div",null,a(t.rightPercent)+"%",1)])])])],2)}const E=f(v,[["render",k]]);const y={components:{PredictionCounter:E},props:["twitchResponse"],data(){return{twitchName:"",isLoggedIn:!1,CSRF_TOKEN:"",authUrl:"",leftPrediction:"",rightPrediction:"",error:"",showDisconnect:!1,headers:{Authorization:"","Client-Id":""},userId:""}},async mounted(){var p;document.addEventListener("mouseover",()=>this.showDisconnect=!0),document.addEventListener("mouseleave",()=>this.showDisconnect=!1);let e="https://llath.github.io/cro_obs_sources/prediction";localStorage.login&&(this.isLoggedIn=localStorage.login),this.CSRF_TOKEN=localStorage.CSRF_TOKEN,(p=this.twitchResponse)!=null&&p.error&&(console.log("ERROR:",this.twitchResponse.error),this.CSRF_TOKEN=this.generateRandomString(25),this.authUrl=`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=d6m4ccxhj4606r1z8mih243bep7dmp&force_verify=true&redirect_uri=${e}&scope=${encodeURIComponent("channel:read:predictions")}&state=${this.CSRF_TOKEN}`,localStorage.CSRF_TOKEN=this.CSRF_TOKEN);const{access_token:i,state:s,token_type:_}=this.twitchResponse,t="d6m4ccxhj4606r1z8mih243bep7dmp",o=i;this.headers={Authorization:`Bearer ${o}`,"Client-Id":t};const h=await fetch("https://api.twitch.tv/helix/users",{headers:this.headers}).then(l=>l.json()),r=h==null?void 0:h.data.shift().id;if(r===void 0){const l="ERROR: undefined user; access_token";console.log(l),this.error=l;return}this.userId=r},watch:{},methods:{generateRandomString(e){return Math.random().toString(36).substring(2,e+2)},authorize(){localStorage.login="true"},disconnect(){localStorage.clear()}}},L=["href"],T={key:2};function O(e,i,s,_,t,o){const h=m("PredictionCounter");return c(),d("div",null,[t.isLoggedIn?u("",!0):(c(),d("a",{key:0,href:t.authUrl,onClick:i[0]||(i[0]=(...r)=>o.authorize&&o.authorize(...r)),class:"connectButton"},"Connect",8,L)),t.isLoggedIn&&t.showDisconnect?(c(),d("a",{key:1,href:"/cro_obs_sources/prediction",class:"disconnectButton",onClick:i[1]||(i[1]=(...r)=>o.disconnect&&o.disconnect(...r))},"Disconnect")):u("",!0),this.error?(c(),d("div",T,a(t.error),1)):u("",!0),t.isLoggedIn?(c(),P(h,{key:3,headers:t.headers,userId:t.userId},null,8,["headers","userId"])):u("",!0)])}const x=f(y,[["render",O]]);export{x as default};
